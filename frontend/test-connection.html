<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Test</title>
</head>
<body>
    <h1>Backend Connection Test</h1>
    <button onclick="testConnection()">Test Health Endpoint</button>
    <button onclick="testCORS()">Test CORS</button>
    <button onclick="testAPI()">Test API Endpoint</button>
    <div id="result"></div>

    <script src="js/config.js"></script>
    <script>
        async function testConnection() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing health endpoint...';
            
            try {
                const response = await fetch(`${API_URL.replace('/api', '')}/health`);
                const data = await response.json();
                resultDiv.innerHTML = `<p style="color: green;">✅ Health endpoint successful!</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ Health endpoint failed: ${error.message}</p>`;
            }
        }

        async function testCORS() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing CORS...';
            
            try {
                const response = await fetch(`${API_URL.replace('/api', '')}/cors-test`);
                const data = await response.json();
                resultDiv.innerHTML = `<p style="color: green;">✅ CORS test successful!</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ CORS test failed: ${error.message}</p>`;
            }
        }

        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing API endpoint...';
            
            try {
                // Test with a token if available
                const token = localStorage.getItem('token');
                const headers = { 'Content-Type': 'application/json' };
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(`${API_URL}/users/user/me`, { headers });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `<p style="color: green;">✅ API test successful!</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML = `<p style="color: orange;">⚠️ API responded but with status ${response.status}: ${response.statusText}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ API test failed: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>